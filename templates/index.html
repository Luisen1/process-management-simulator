<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Planificación de Procesos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-microchip"></i> Simulador de Planificación de Procesos</h1>
            <p class="subtitle">Algoritmo Actual: <span id="current-algorithm">{{ current_algorithm }}</span></p>
        </header>

        <!-- Panel de Control -->
        <div class="control-panel">
            <div class="algorithm-selector">
                <label for="algorithm-select">Seleccionar Algoritmo:</label>
                <select id="algorithm-select">
                    <option value="FCFS" {% if current_algorithm == 'FCFS' %}selected{% endif %}>FCFS (First-Come, First-Served)</option>
                    <option value="SJF" {% if current_algorithm == 'SJF' %}selected{% endif %}>SJF (Shortest Job First)</option>
                    <option value="RR" {% if current_algorithm == 'RR' %}selected{% endif %}>Round Robin</option>
                </select>
                <button id="change-algorithm-btn" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i> Cambiar Algoritmo
                </button>
            </div>
            
            <!-- Control de Quantum para Round Robin -->
            <div id="quantum-control" class="quantum-control" style="display: none;">
                <label for="quantum-input">Quantum (unidades de tiempo):</label>
                <input type="number" id="quantum-input" name="quantum" min="1" max="20" value="3" placeholder="3">
                <button id="set-quantum-btn" class="btn btn-info">
                    <i class="fas fa-cog"></i> Configurar Quantum
                </button>
                <span id="current-quantum" class="quantum-display">Quantum actual: 3</span>
            </div>
        </div>

        <!-- Formulario para añadir procesos -->
        <div class="process-form">
            <h2><i class="fas fa-plus"></i> Añadir Proceso</h2>
            <form id="process-form">
                <div class="form-group">
                    <label for="process-id">ID del Proceso:</label>
                    <input type="text" id="process-id" name="pid" placeholder="Ej: P1, P2, P3..." required>
                </div>
                <div class="form-group">
                    <label for="arrival-time">Tiempo de Llegada (AT):</label>
                    <input type="number" id="arrival-time" name="arrival_time" min="0" placeholder="0" required>
                </div>
                <div class="form-group">
                    <label for="burst-time">Tiempo de Ráfaga (BT):</label>
                    <input type="number" id="burst-time" name="burst_time" min="1" placeholder="1" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Añadir Proceso
                </button>
            </form>
        </div>

        <!-- Lista de procesos añadidos -->
        <div class="process-list">
            <h3><i class="fas fa-list"></i> Procesos Añadidos</h3>
            <div id="added-processes">
                <p class="no-processes">No hay procesos añadidos aún.</p>
            </div>
            <div class="process-actions">
                <button id="schedule-btn" class="btn btn-success" disabled>
                    <i class="fas fa-play"></i> Ejecutar Planificación
                </button>
                <button id="reset-btn" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Reiniciar
                </button>
            </div>
        </div>

        <!-- Resultados -->
        <div id="results-section" class="results-section" style="display: none;">
            <h2><i class="fas fa-chart-bar"></i> Resultados de la Planificación</h2>
            
            <!-- Diagrama de Gantt -->
            <div class="gantt-section">
                <h3><i class="fas fa-chart-gantt"></i> Diagrama de Gantt</h3>
                <div id="gantt-chart" class="gantt-chart"></div>
                <div id="gantt-timeline" class="gantt-timeline"></div>
            </div>

            <!-- Tabla de resultados -->
            <div class="table-section">
                <h3><i class="fas fa-table"></i> Tabla de Resultados</h3>
                <div class="table-container">
                    <table id="results-table">
                        <thead>
                            <tr>
                                <th>Proceso</th>
                                <th>AT</th>
                                <th>BT</th>
                                <th>CT</th>
                                <th>TT</th>
                                <th>WT</th>
                                <th id="quantum-column" style="display: none;">QU</th>
                                <th id="ntat-column" style="display: none;">NTAT</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los resultados se llenarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Métricas promedio -->
            <div class="metrics-section">
                <h3><i class="fas fa-calculator"></i> Métricas</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <i class="fas fa-clock"></i>
                        <h4>Tiempo Promedio de Espera</h4>
                        <p id="avg-waiting-time">-</p>
                    </div>
                    <div class="metric-card">
                        <i class="fas fa-hourglass-half"></i>
                        <h4>Tiempo Promedio de Turnaround</h4>
                        <p id="avg-turnaround-time">-</p>
                    </div>
                    <div class="metric-card">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>Efecto Convoy</h4>
                        <p id="convoy-effect">-</p>
                    </div>
                </div>
            </div>
            
            <!-- Estadísticas Detalladas -->
            <div id="statistics-section" class="statistics-section" style="display: none;">
                <h3><i class="fas fa-chart-line"></i> Estadísticas Detalladas</h3>
                <div class="statistics-container">
                    <table id="statistics-table" class="statistics-table">
                        <thead>
                            <tr>
                                <th>Métrica</th>
                                <th>Media (μ)</th>
                                <th>Desv. Estándar (σ)</th>
                                <th>Mínimo</th>
                                <th>Máximo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Las estadísticas se llenarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
                <div class="statistics-info">
                    <p><i class="fas fa-info-circle"></i> <strong>Interpretación:</strong></p>
                    <ul>
                        <li><strong>Media (μ):</strong> Valor promedio de la métrica</li>
                        <li><strong>Desviación Estándar (σ):</strong> Medida de dispersión (valores más altos indican mayor variabilidad)</li>
                        <li><strong>Mínimo/Máximo:</strong> Rango de valores observados</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Mensajes de estado -->
        <div id="messages" class="messages"></div>
    </div>

    <!-- Explicación del algoritmo -->
    <div class="info-section">
        <h3><i class="fas fa-info-circle"></i> Información del Algoritmo</h3>
        <div class="info-content">
            <div id="fcfs-info" class="algorithm-info">
                <p><strong>First-Come, First-Served (FCFS)</strong> es el algoritmo de planificación más simple:</p>
                <ul>
                    <li><strong>AT (Arrival Time):</strong> Momento en que el proceso llega al sistema</li>
                    <li><strong>BT (Burst Time):</strong> Tiempo que el proceso necesita para completarse</li>
                    <li><strong>CT (Completion Time):</strong> Momento en que el proceso termina su ejecución</li>
                    <li><strong>TT (Turnaround Time):</strong> CT - AT (tiempo total en el sistema)</li>
                    <li><strong>WT (Waiting Time):</strong> TT - BT (tiempo esperando para ejecutarse)</li>
                    <li><strong>Convoy Effect:</strong> Los procesos largos pueden retrasar significativamente a los cortos</li>
                </ul>
                <div class="algorithm-characteristics">
                    <h4><i class="fas fa-star"></i> Características de FCFS:</h4>
                    <ul>
                        <li>✅ <strong>Simple de implementar</strong> y entender</li>
                        <li>✅ <strong>Justo:</strong> Respeta el orden de llegada</li>
                        <li>⚠️ <strong>No óptimo:</strong> Puede tener tiempos de espera altos</li>
                        <li>⚠️ <strong>Convoy Effect:</strong> Procesos largos bloquean a los cortos</li>
                    </ul>
                </div>
            </div>
            <div id="sjf-info" class="algorithm-info" style="display: none;">
                <p><strong>Shortest Job First (SJF)</strong> es un algoritmo "injusto" que prioriza la eficiencia sobre la equidad:</p>
                <ul>
                    <li><strong style="color: #e74c3c;">AT (Arrival Time):</strong> <span style="color: #e74c3c;">⚠️ NO se considera para el ordenamiento</span></li>
                    <li><strong style="color: #27ae60;">BT (Burst Time):</strong> <span style="color: #27ae60;">✅ Criterio principal de ordenamiento (menor a mayor)</span></li>
                    <li><strong>CT (Completion Time):</strong> Momento en que el proceso termina su ejecución</li>
                    <li><strong>TT (Turnaround Time):</strong> CT - AT (tiempo total en el sistema)</li>
                    <li><strong>WT (Waiting Time):</strong> TT - BT (tiempo esperando para ejecutarse)</li>
                </ul>
                <div class="algorithm-characteristics">
                    <h4><i class="fas fa-star"></i> Características de SJF:</h4>
                    <ul>
                        <li>✅ <strong>Óptimo:</strong> Minimiza el tiempo promedio de espera</li>
                        <li>✅ <strong>Eficiente:</strong> Mejores métricas de rendimiento</li>
                        <li>⚠️ <strong>Injusto:</strong> Ignora el orden de llegada</li>
                        <li>❌ <strong>Starvation:</strong> Procesos largos pueden no ejecutarse nunca</li>
                        <li>❌ <strong>Imposible en práctica:</strong> Requiere conocer BT de antemano</li>
                    </ul>
                </div>
                <div class="algorithm-warning">
                    <h4><i class="fas fa-exclamation-triangle"></i> ¿Por qué es "Injusto"?</h4>
                    <p>SJF prioriza los procesos más cortos sin importar cuándo llegaron. Un proceso que llega primero pero es largo puede ejecutarse después de procesos que llegaron mucho más tarde pero son más cortos. Esto viola el principio de "primero en llegar, primero en ser atendido".</p>
                </div>
            </div>
            <div id="rr-info" class="algorithm-info" style="display: none;">
                <p><strong>Round Robin (RR)</strong> es un algoritmo preemptivo que proporciona equidad temporal:</p>
                <ul>
                    <li><strong>AT (Arrival Time):</strong> Momento en que el proceso llega al sistema</li>
                    <li><strong>BT (Burst Time):</strong> Tiempo que el proceso necesita para completarse</li>
                    <li><strong>CT (Completion Time):</strong> Momento en que el proceso termina su ejecución</li>
                    <li><strong>TT (Turnaround Time):</strong> CT - AT (tiempo total en el sistema)</li>
                    <li><strong>WT (Waiting Time):</strong> TT - BT (tiempo esperando para ejecutarse)</li>
                    <li><strong style="color: #3498db;">QU (Quantum Used):</strong> <span style="color: #3498db;">✨ Cantidad total de unidades de quantum que usó el proceso</span></li>
                    <li><strong style="color: #e67e22;">NTAT (Normalized TAT):</strong> <span style="color: #e67e22;">📊 TT/BT - Tiempo de turnaround normalizado</span></li>
                </ul>
                <div class="algorithm-characteristics">
                    <h4><i class="fas fa-star"></i> Características de Round Robin:</h4>
                    <ul>
                        <li>✅ <strong>Preemptivo:</strong> Los procesos pueden ser interrumpidos</li>
                        <li>✅ <strong>Justo:</strong> Todos los procesos reciben tiempo de CPU equitativamente</li>
                        <li>✅ <strong>Responsivo:</strong> Buena respuesta interactiva</li>
                        <li>⚠️ <strong>Context Switching:</strong> Genera cambios de contexto</li>
                        <li>⚠️ <strong>Quantum Crítico:</strong> El rendimiento depende del valor del quantum</li>
                    </ul>
                </div>
                <div class="algorithm-insights">
                    <h4><i class="fas fa-lightbulb"></i> Configuración del Quantum:</h4>
                    <ul>
                        <li><strong>Quantum Pequeño (1-2):</strong> Mayor equidad, pero más overhead por cambios de contexto</li>
                        <li><strong>Quantum Mediano (3-5):</strong> Buen balance entre equidad y eficiencia</li>
                        <li><strong>Quantum Grande (>10):</strong> Se aproxima a FCFS, menos cambios de contexto</li>
                    </ul>
                    <div class="formula-box">
                        <h5><i class="fas fa-calculator"></i> Fórmulas Importantes:</h5>
                        <ul>
                            <li><strong>TT = CT - AT</strong> (Turnaround Time)</li>
                            <li><strong>WT = TT - BT</strong> (Waiting Time)</li>
                            <li><strong>NTAT = TT / BT</strong> (Normalized Turnaround Time)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/examples.js') }}"></script>
</body>
</html>
